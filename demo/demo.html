<html>
<head>
  <link href="stylesheets/grid.css" media="screen" rel="stylesheet" type="text/css" />
  <script src="js/jquery.min.js" type="text/javascript"></script>
</head>
<body>
<div class="container_12">
  <div class="grid_3">
    <h3>add</h3>
    <input type="text" class="add" value="42"/>
    <input type="text" class="add" value="14"/>
    <input type="text" class="add" value="28"/>

  </div>

  <div class="grid_3">
    <h3>subtract</h3>

    <input type="text" class="subtract" value="6"/>
    <input type="text" class="subtract" value="12"/>
    <input type="text" class="subtract" value="24"/>
  </div>
  <div class="grid_3">
    <h3>multiply</h3>
    <input type="text" id="multiply"  value="0.5"/>
  </div>
  <div class="grid_3">
    <h3>divisor</h3>
    <input type="text" id="divisor"  value="0.25"/>
  </div>
  <div class="grid_12" style="border:black solid thin;padding:15px;margin-top:15px" id="total">total</div>
</div>
</body>
<script type="text/javascript">
  function calculate_total(params){
    var total = 0;
    var items = params["add"];
    for ( var i in items){
      total += items[i];
    }
    items = params["subtract"];
    for (var i in items){
      total -= items[i];
    }
    $("#total").html((total *  params["multiply"] ) / params["divisor"]);
  }

 function make_magic(singleItems, multipleItems, pollTimeout) {
    //set defaults 
    if (pollTimeout === undefined){
      pollTimeout = 3000;
    }
    //build functions 
    var onValuesChanged = function () {
      var params = new Array();
      for (var id in singleItems){
        params[singleItems[id]] = parseFloat($("#" + singleItems[id]).val());
      }
      for (var klass in multipleItems){
        var collection = new Array();
        var items = $("." + multipleItems[klass]);
        jQuery.each(items, function(index,value){
          collection[index] = parseFloat($(value).val());
        });
        params[multipleItems[klass]] = collection;
      }
      calculate_total(params);
    };
    var pollForChanges = function () {
      onValuesChanged();
      setTimeout(pollForChanges, pollTimeout);
    };
    // set up on change events 
    for (var id in singleItems){
      $("#" + singleItems[id]).change(onValuesChanged());
    }
    for (var klas in multipleItems){
      $("." + multipleItems[klas]).change(onValuesChanged());
    }
    //at the end call the function
    pollForChanges();
  }
  $(function(){
    make_magic(["multiply", "divisor"], ["add","subtract"]);
  });
  
</script>

</html>
